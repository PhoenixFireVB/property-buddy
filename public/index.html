<!DOCTYPE html>
<meta charset="utf-8">

<body>
  <script src="//d3js.org/d3.v3.min.js"></script>
  <script src="//d3js.org/d3-collection.v1.min.js"></script>
  <script src="//d3js.org/d3-dispatch.v1.min.js"></script>
  <script src="//d3js.org/d3-dsv.v1.min.js"></script>
  <script src="//d3js.org/d3-request.v1.min.js"></script>
  <script src="//d3js.org/d3-array.v1.min.js"></script>
  <script src="//d3js.org/d3-geo.v1.min.js"></script>
  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <script>
    function checkAICUZ(position) {

      console.log("Checking AICUZ for position:");
      console.log(position);

      d3.request("http://gis-vbgov.opendata.arcgis.com/datasets/3088488c6c284f3981d61b9efe9c1d04_3.geojson")
        .mimeType("application/json")
        .response(function(xhr) {
          return JSON.parse(xhr.responseText);
        })
        .get(function(data) {

          console.log(data);

          var ll = [position.coords.longitude, position.coords.latitude];

          var msg = "You are in AICUZ zone: ";

          if (d3.geoContains(data.features[0], ll)) {
            d3.select("body").append("span")
              .text(msg + data.features[0].properties.ZONE_);
          } else if (d3.geoContains(data.features[1], ll)) {
            d3.select("body").append("span")
              .text(msg + data.features[1].properties.ZONE_);
          } else if (d3.geoContains(data.features[2], ll)) {
            d3.select("body").append("span")
              .text(msg + data.features[2].properties.ZONE_);
          } else if (d3.geoContains(data.features[3], ll)) {
            d3.select("body").append("span")
              .text(msg + data.features[3].properties.ZONE_);
          } else {
            d3.select("body").append("span")
              .text("You are not in any AICUZ Noise Zone.");
          }


        });
    }

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(checkAICUZ);
      } else {
        d3.select("body").append("span")
          .text("Geolocation is not supported by this browser.");
      }
    }

    $(document).ready(function() {
      getLocation();
    })

  </script>
